<div id="main-wrapper">
    <div class="container-fluid mw-100">
        <div class="row">
            <div class="datatables">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="mb-2">
                                    <h5 class="mb-0">File export</h5>
                                </div>
                                <p class="card-subtitle mb-3">
                                    Datos de los estudiantes HABILITADOS
                                </p>
                                <div class="table-responsive">
                                    <table id="file_export"
                                        class="table border w-100 table-striped table-bordered display text-nowrap"
                                        style="font-size: 12px">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Nombres</th>
                                                <th>Apellido Parteno</th>
                                                <th>Apellido Materno</th>
                                                <th>C.I</th>
                                                <th>Colegio</th>
                                                <th>Grado</th>
                                                <th>Opciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="e, index : ${estudiantes}" th:if="${e.estado != 'INHABILITADO'}">
                                                <td th:text="${index.index+1}"></td>
                                                <td th:text="${e.persona.nombre}"></td>
                                                <td th:text="${e.persona.paterno}"></td>
                                                <td th:text="${e.persona.materno}"></td>
                                                <td th:text="${e.persona.ci}"></td>
                                                <td th:text="${e.colegio.nombreColegio}"></td>
                                                <td th:text="${e.grado}"></td>
                                                <td class="text-center">
                                                    <a class="btn btn-info me-2" type="button" style="color: aliceblue;"
                                                        data-bs-toggle="modal" data-bs-target="#verEstudianteModal"
                                                        th:attr="onclick='cargarDatosFormulario(' + ${e.idEstudiante} + ', \'view\')'">
                                                        <i class="ti ti-eye"> Datos</i>
                                                    </a>
                                                    <a class="btn btn-warning me-2" type="button" style="color: aliceblue;"
                                                        data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                                        th:attr="onclick='editarDatosEstudiantes(\'' + ${e.idEstudiante} + '\', \'edit\')'">
                                                        <i class="ti ti-pencil"> Editar</i>
                                                    </a>
                                                    <a class="btn btn-danger me-2" type="button" style="color: aliceblue;"
                                                        data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                                        th:attr="onclick='cargarModFormulario(\'' + ${e.idEstudiante} + '\')'">
                                                        <i class="ti ti-ban"> Banear</i>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#file_export').DataTable({
            dom: 'Bfrtip',
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ]
        });
    });
</script>

<div class="modal fade" id="verEstudianteModal" data-bs-backdrop="static"
    data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content" id="FormularioEstudianteVista_">
            
        </div>
    </div>
</div>

<div class="modal fade" id="editarEstudianteModal" data-bs-backdrop="static"
    data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel1"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content" id="FormularioEstudianteEditar_">
            <div class="modal-body">
                <form action="/editarEstudianteVista" method="POST" >
                    <div class="row">
                        <div class="form-group col-md-3 mb-3">
                            <label for="nombre">Nombre Estudiante</label>
                            <input class="form-control" id="nombre" name="nombre" readonly>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label for="paterno">Apellido Paterno</label>
                            <input class="form-control" id="paterno" name="paterno" readonly>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label for="materno">Apellido Materno</label>
                            <input class="form-control" id="materno" name="materno" readonly>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-4 mb-3">
                            <label for="ci">Ci</label>
                            <input class="form-control" id="ci" name="" readonly>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label for="genero">Genero</label><br>
                            <select class="form-select" id="genero">
                                <th:block th:each="g : ${generos}">
                                    <option th:value="${g.idGenero}" th:text="${g.nombreGenero}"></option>
                                </th:block>
                            </select>
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label for="correo">Correo Electronico</label>
                            <input class="form-control" id="correo" name="correo">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-3 mb-3">
                            <label for="nacionalidad">Nacionalidad</label><br>
                            <select class="form-select" id="nacionalidad">
                                <th:block th:each="nac : ${nacionalidades}">
                                    <option th:value="${nac.idNacionalidad}" th:text="${nac.nombreNacionalidad}"></option>
                                </th:block>
                            </select>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label for="colegio">Colegio</label><br>
                            <select class="form-select" id="colegio">
                                <th:block th:each="col : ${colegioss}">
                                    <option th:value="${col.idColegio}" th:text="${col.nombreColegio}"></option>
                                </th:block>
                            </select>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label for="grado">Grado</label>
                            <input class="form-control" id="grado" name="grado">
                        </div>
                    </div>
            
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success" th:text="${edit} ? 'Guardar Cambios'" style="display: none;"></button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function cargarDatosFormulario(idEstudiante) {
        $.ajax({
            url: '/datosEstudiante/' + idEstudiante,
            method: 'GET',
            success: function (response) {
                $("#FormularioEstudianteVista_").html(response);
                $('#verEstudianteModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }

    function editarDatosEstudiantes(idEstudiante) {
        $.ajax({
            url: '/formularioEditEstudinateVista/' + idEstudiante,
            method: 'GET',
            success: function (response) {
                $("#FormularioEstudianteEditar_").html(response);
                $('#editEstudianteId').val(idEstudiante);
                $('#editarEstudianteModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.log(error);
            }
        });
    }

    $(document).ready(function() {
    $('.btn-info').click(function() {
        var idEstudiante = $(this).data('id');
        cargarDatosEstudiante(idEstudiante);
    });

    $('.btn-warning').click(function() {
        var idEstudiante = $(this).data('id');
        editarDatosEstudiantes(idEstudiante);
    });
    });

    $(document).ready(function() {
        $('#mostraEditEstudiante').submit(function (event) {
            event.preventDefault();
            var form = document.getElementById("mostraEditEstudiante");
            var action = form.action;
            var formData = $(this).serialize();
            $.ajax({
                type: 'POST',
                url: $(this).attr('action'),
                data: formData,
                contentType: 'application/x-www-form-urlencoded',
                success: function (response) {
                    var mensaje = response;
                    if (mensaje === 'Se modificó el registro con éxito') {
                        Swal.fire(
                            'Modificado!',
                            mensaje + '.',
                            'success'
                        );
                    }else{
                        if (mensaje === 'Ha ocurrido un error') {
                            Swal.fire(
                                'Imposible Continuar!',
                                mensaje + '.',
                                'error'
                            );
                        }
                    }
                },
                error: function (xhr, status, error) {
                    toastr.error('Ha ocurrido un error. Por favor, intenta nuevamente.' + xhr, status, error);
                    console.error(error);
                }
            });
        });
    });
</script>