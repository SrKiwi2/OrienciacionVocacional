<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light" data-color-theme="Blue_Theme" data-layout="vertical">

    <body>
        <div id="main-wrapper">
            <div class="">
                <div class="">
                    <div class="container-fluid mw-100">

                        <div class="row">
                            <div class="datatables">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="mb-2">
                                                    <h5 class="mb-0">File export</h5>
                                                </div>
                                                <p class="card-subtitle mb-3">
                                                    Datos de los estudiantes HABILITADOS
                                                </p>
                                                <div class="table-responsive">
                                                    <table id="file_export"
                                                        class="table border w-100 table-striped table-bordered display text-nowrap"
                                                        style="font-size: 12px">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Nombres</th>
                                                                <th>Apellido Parteno</th>
                                                                <th>Apellido Materno</th>
                                                                <th>C.I</th>
                                                                <th>Colegio</th>
                                                                <th>Grado</th>
                                                                <th>Opciones</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr th:each="e, index : ${estudiantes}" th:if="${e.estado != 'INHABILITADO'}">
                                                                <td th:text="${index.index+1}"></td>
                                                                <td th:text="${e.persona.nombre}"></td>
                                                                <td th:text="${e.persona.paterno}"></td>
                                                                <td th:text="${e.persona.materno}"></td>
                                                                <td th:text="${e.persona.ci}"></td>
                                                                <td th:text="${e.colegio.nombreColegio}"></td>
                                                                <td th:text="${e.grado}"></td>
                                                                <td class="text-center">
                                                                    <a class="btn btn-info me-2" type="button" style="color: aliceblue;"
                                                                        data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                                                        th:attr="onclick='cargarModFormulario(\'' + ${e.idEstudiante} + '\', \'view\')'">
                                                                        <i class="ti ti-eye"> Datos</i>
                                                                    </a>
                                                                    <a class="btn btn-warning me-2" type="button" style="color: aliceblue;"
                                                                        data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                                                        th:attr="onclick='cargarModFormulario(\'' + ${e.idEstudiante} + '\', \'edit\')'">
                                                                        <i class="ti ti-pencil"> Editar</i>
                                                                    </a>
                                                                    <a class="btn btn-danger me-2" type="button" style="color: aliceblue;"
                                                                        data-bs-toggle="modal" data-bs-target="#staticBackdrop"
                                                                        th:attr="onclick='cargarModFormulario(\'' + ${e.idEstudiante} + '\')'">
                                                                        <i class="ti ti-ban"> Banear</i>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODALS WACHINES -->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static"
            data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-lg">
                <div class="modal-content" id="FormularioEstudianteVista_">
                    
                </div>
            </div>
        </div>
        <!-- FIN MODALS -->

        <script>

            function cargarModFormulario(idEstudiante, mode) {
                $.ajax({
                    url: '/formularioEditEstudinateVista/' + idEstudiante + '?mode=' + mode,
                    method: 'GET',
                    success: function (response) {
                        $("#FormularioEstudianteVista_").html(response);

                        const isEditable = (mode === 'edit');
                        $('#mostraEditEstudiante input').prop('readonly', !isEditable); // Habilitar/deshabilitar campos
                        $('#mostraEditEstudiante button[type="submit"]').toggle(isEditable); // Mostrar botón de guardar solo en modo edición
                    },
                    error: function (xhr, status, error) {
                        console.log(error);
                    }
                });
            }

            $(document).ready(function() {
                $('#mostraEditEstudiante').submit(function (event) {
                    event.preventDefault();
                    var form = document.getElementById("mostraEditEstudiante");
                    var action = form.action;
                    var formData = $(this).serialize();
                    $.ajax({
                        type: 'POST',
                        url: $(this).attr('action'),
                        data: formData,
                        contentType: 'application/x-www-form-urlencoded',
                        success: function (response) {
                            var mensaje = response;
                            if (mensaje === 'Se modificó el registro con éxito') {
                                Swal.fire(
                                    'Modificado!',
                                    mensaje + '.',
                                    'success'
                                );
                            }else{
                                if (mensaje === 'Ha ocurrido un error') {
                                    Swal.fire(
                                        'Imposible Continuar!',
                                        mensaje + '.',
                                        'error'
                                    );
                                }
                            }
                        },
                        error: function (xhr, status, error) {
                            toastr.error('Ha ocurrido un error. Por favor, intenta nuevamente.' + xhr, status, error);
                            console.error(error);
                        }
                    });
                });
            });

        </script>
    </body>
</html>